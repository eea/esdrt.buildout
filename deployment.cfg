[buildout]
socket-timeout = 60

extends =
    https://raw.github.com/eea/eea.plonebuildout.core/master/deployment.cfg
    versions.cfg
    secret.cfg

parts +=
    memcached-ctl
    updates
    checkinterval-script
    checkinterval

auto-checkout =
    edw.userhistory


[poundconfig]
balancers =
    dogs 127.0.0.1:${configuration:pound-port} ${configuration:dog4}:${configuration:www1-http-port} ${configuration:dog4}:${configuration:www2-http-port} ${configuration:dog5}:${configuration:www1-http-port} ${configuration:dog5}:${configuration:www2-http-port} ${configuration:dog6}:${configuration:www1-http-port} ${configuration:dog6}:${configuration:www2-http-port} ${configuration:dog7}:${configuration:www1-http-port} ${configuration:dog4}:${configuration:www2-http-port} ${configuration:dog8}:${configuration:www1-http-port} ${configuration:dog8}:${configuration:www2-http-port} ${configuration:dog9}:${configuration:www1-http-port} ${configuration:dog9}:${configuration:www2-http-port} ${configuration:dog10}:${configuration:www1-http-port} ${configuration:dog10}:${configuration:www2-http-port} ${configuration:dog11}:${configuration:www1-http-port} ${configuration:dog11}:${configuration:www2-http-port} ${configuration:dog12}:${configuration:www1-http-port} ${configuration:dog12}:${configuration:www2-http-port} ${configuration:dog13}:${configuration:www1-http-port} ${configuration:dog13}:${configuration:www2-http-port}

[apache-conf]
recipe = collective.recipe.template
url = file://${buildout:directory}/templates/apache.tpl
output = ${buildout:directory}/etc/apache-vh.conf

# We are not using the async server
[www-async]
recipe =

[checkinterval-script]
recipe = zc.recipe.egg
eggs = jarn.checkinterval

[checkinterval]
recipe = cs.recipe.checkinterval

[www1]
user = ${secrets:user}
zope-conf-imports = eea.graylogger
event-log-custom =
  <graylog>
    server ${secrets:logging-address}:${secrets:logging-port}
    facility ${:_buildout_section_name_}
  </graylog>
  <syslog>
    address /dev/log
    facility local4
    format ${:_buildout_section_name_}: %(message)s
    level info
  </syslog>

access-log-custom =
  <graylog>
    server ${secrets:logging-address}:${secrets:logging-port}
    facility ${:_buildout_section_name_}-Z2
  </graylog>
  <syslog>
    address /dev/log
    facility local1
    format ${:_buildout_section_name_}-Z2: %(message)s
    level info
  </syslog>

environment-vars =
    ${dbclient:environment-vars}

[configuration]
shared-blob = on
blob-storage = /var/sharedblobs/blobs
blob-storage-cache = /var/sharedblobs/blobs
effective-user = zope
eggs +=
    plone.app.ldap
    Products.MemcachedManager
    eea.graylogger
eggs -=
    RelStorage
    psycopg2
    pylibmc

memcache-address = ${secrets:IMPALA}
memcache-port = 11211
memcache-size = 1024

www-domain = ${secrets:WWW_DOMAIN}
www1-http-port = 8001
www2-http-port = 8002

python-check-interval = 1530

zeo-monitor-address = ${secrets:BONGO}:2001
zeoserver-address = ${secrets:BONGO}:2000

# server ip-addresses. See #24328
dog4 = ${secrets:DOG4}
dog5 = ${secrets:DOG5}
dog6 = ${secrets:DOG6}
dog7 = ${secrets:DOG7}
dog8 = ${secrets:DOG8}
dog9 = ${secrets:DOG9}
dog10 = ${secrets:DOG10}
dog11 = ${secrets:DOG11}
dog12 = ${secrets:DOG12}
dog13 = ${secrets:DOG13}


impala = ${secrets:IMPALA}
bongo = ${secrets:BONGO}
